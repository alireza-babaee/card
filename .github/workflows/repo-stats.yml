      - name: محاسبه و ذخیره آمار دائمی
        run: |
          # ← این بخش رو کامل جایگزین کن
          mkdir -p stats
          TODAY=$(date '+%Y-%m-%d %H:%M')

          # درست کردن خروجی API اگر فقط عدد بود
          if [[ $(jq -e 'type == "number"' views.json >/dev/null 2>&1; echo $?) -eq 0 ]]; then
            VIEWS_COUNT=$(cat views.json)
            UNIQUES_COUNT=0
          else
            VIEWS_COUNT=$(jq '.count // 0' views.json)
            UNIQUES_COUNT=$(jq '.uniques // 0' views.json)
          fi

          if [[ $(jq -e 'type == "number"' clones.json >/dev/null 2>&1; echo $?) -eq 0 ]]; then
            CLONES_COUNT=$(cat clones.json)
            UNIQUES_CLONES=0
          else
            CLONES_COUNT=$(jq '.count // 0' clones.json)
            UNIQUES_CLONES=$(jq '.uniques // 0' clones.json)
          fi

          # اضافه کردن به لاگ
          echo "$TODAY: Views $VIEWS_COUNT (Unique: $UNIQUES_COUNT)" >> stats/views-log.txt
          echo "$TODAY: Clones $CLONES_COUNT (Unique: $UNIQUES_CLONES)" >> stats/clones-log.txt

          # محاسبه total (بهترین روش ممکن)
          TOTAL_VIEWS=$(awk '{sum += $4} END {print sum+0}' stats/views-log.txt 2>/dev/null || echo 0)
          TOTAL_CLONES=$(awk '{sum += $4} END {print sum+0}' stats/clones-log.txt 2>/dev/null || echo 0)

          # ذخیره فایل‌ها
          echo "$TOTAL_VIEWS" > stats/total-views.txt
          echo "$TOTAL_CLONES" > stats/total-clones.txt

          # فایل JSON تمیز
          cat > stats/summary.json <<EOF
          {
            "last_update": "$TODAY",
            "today_views": $VIEWS_COUNT,
            "today_unique_views": $UNIQUES_COUNT,
            "today_clones": $CLONES_COUNT,
            "today_unique_clones": $UNIQUES_CLONES,
            "total_views": $TOTAL_VIEWS,
            "total_clones": $TOTAL_CLONES
          }
          EOF
